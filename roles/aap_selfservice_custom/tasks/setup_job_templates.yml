---
# SPDX-License-Identifier: MIT-0
# Create demo job templates in AAP

- name: Display job templates creation start
  ansible.builtin.debug:
    msg: "Creating {{ aap_selfservice_custom_job_templates | length }} demo job templates..."
  when: aap_selfservice_custom_debug | bool

- name: Create AAP job templates
  ansible.controller.job_template:
    name: "{{ item.name }}"
    description: "{{ item.description | default('') }}"
    job_type: "{{ item.job_type | default('run') }}"
    organization: "{{ item.organization | default(aap_selfservice_custom_organization) }}"
    inventory: "{{ item.inventory }}"
    project: "{{ item.project }}"
    playbook: "playbooks/{{ item.playbook }}"
    credentials: "{{ item.credentials | default([]) }}"
    labels: "{{ item.labels | default([]) }}"
    ask_inventory_on_launch: "{{ item.ask_inventory_on_launch | default(false) }}"
    ask_credential_on_launch: "{{ item.ask_credential_on_launch | default(false) }}"
    state: present
    controller_host: "{{ aap_selfservice_custom_controller_url }}"
    controller_username: "{{ aap_selfservice_custom_admin_username }}"
    controller_password: "{{ aap_selfservice_custom_admin_password }}"
    validate_certs: "{{ aap_selfservice_custom_verify_ssl }}"
  loop: "{{ aap_selfservice_custom_job_templates }}"
  loop_control:
    label: "{{ item.name }}"
  register: _job_template_result
  failed_when:
    - _job_template_result is failed
    - not aap_selfservice_custom_skip_existing
    - "'already exists' not in (_job_template_result.msg | default(''))"

- name: Display job templates creation complete
  ansible.builtin.debug:
    msg: "Successfully created {{ aap_selfservice_custom_job_templates | length }} job templates"
